# Meshtopo Configuration Template
# Copy this file to config.yaml and update with your settings

# Configuration for the MQTT Broker connection
mqtt:
    use_internal_broker: true # Use integrated Mosquitto broker
    broker: "mosquitto" # Broker hostname (internal service name when use_internal_broker: true)
    port: 1883 # MQTT broker port
    username: "your_mqtt_user"
    password: "your_mqtt_password"
    topic: "msh/+/+/json/position/#"

# Configuration for the CalTopo API
caltopo:
    group: "MESH-TEAM-ALPHA"
    map_id: "" # Selected map ID (set via web UI)

    # CalTopo Team API configuration (for map selection feature)
    team_api:
        enabled: false # Enable Team API integration
        credential_id: "" # CalTopo service account credential ID
        secret_key: "" # CalTopo service account secret key

# Mapping of Meshtastic hardware IDs to CalTopo device IDs
nodes:
    "!823a4edc":
        device_id: "TEAM-LEAD"
    "!a4b8c2f0":
        device_id: "COMMS"

# User accounts for web UI authentication
# Generate password hashes using: python -c "import bcrypt; print(bcrypt.hashpw('your_password'.encode(), bcrypt.gensalt()).decode())"
users:
    - username: "admin"
      password_hash: "$2b$12$..." # Replace with actual bcrypt hash
      role: "admin"
      caltopo_credentials:
          credential_id: "ABC123DEF456"
          secret_key: "base64_encoded_secret"
          accessible_maps: ["map-id-1", "map-id-2"]

    - username: "user1"
      password_hash: "$2b$12$..." # Replace with actual bcrypt hash
      role: "user"
      caltopo_credentials:
          credential_id: "XYZ789GHI012"
          secret_key: "base64_encoded_secret"
          accessible_maps: ["map-id-3"]

# SSL/TLS configuration for automatic certificate provisioning
ssl:
    enabled: false # Master toggle for SSL features
    email: "admin@example.com" # Email for Let's Encrypt notifications
    domain: "meshtopo.example.com" # Primary domain
    acme_challenge: "http" # Challenge type: "http" or "dns"

    # Per-service SSL configuration
    services:
        web_ui:
            enabled: true
            subdomain: "meshtopo" # Subdomain for web UI
        mqtt:
            enabled: false # MQTT over TLS (optional)
            port: 8883

# Web management interface configuration
web_ui:
    enabled: false # Master toggle for web UI
    host: "0.0.0.0" # Bind address
    port: 8080 # Bind port
    secret_key: "" # Flask session secret (generate random string)

    # Session configuration
    session:
        timeout: 3600 # Session timeout in seconds
        secure: true # Secure cookies (HTTPS only)
        httponly: true # HTTP-only cookies

    # Rate limiting
    rate_limit:
        enabled: true
        requests_per_minute: 60

# Logging configuration
logging:
    level: "INFO" # DEBUG, INFO, WARN, ERROR
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

    # File logging (optional)
    file:
        enabled: false
        path: "/app/logs/meshtopo.log"
        max_size: "10MB"
        backup_count: 5

    # Web UI specific logging
    web_ui:
        level: "INFO"
        access_log: true
